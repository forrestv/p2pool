machine:
   python:
    version: 2.7.6
general:
  branches:
    only:
      - feature-bitcoin-regtest
  artifacts:
    #- "coverage" # relative to the user's home directory
dependencies:
  pre:
    - sudo apt-add-repository ppa:bitcoin/bitcoin -y
    - sudo apt-get update -q
    - sudo apt-get install --no-install-recommends --no-upgrade -qq bitcoind
  override:
    - pip install -q -r requirements.txt
test:
  pre:
    # Are we starting with a empty home directory?
    - ls -lah /home/ubuntu/
    # setup and launch bitcoind
    - mkdir /home/ubuntu/.bitcoin
    - cp test-data/bitcoin.conf /home/ubuntu/.bitcoin/.
    - chmod 600 /home/ubuntu/.bitcoin/bitcoin.conf
    - bitcoind --regtest --daemon:
        background: true
    - sleep 5
    # run checks that bitcoind is running
    - bitcoin-cli --regtest setgenerate true 50
    - bitcoin-cli --regtest getinfo
    - bitcoin-cli --regtest getblockhash 20
    # launch p2pool to test against
    - python run_p2pool.py --regtest --verbose --debug --irc-announce:
        background: true
    - sleep 60
  override:
    - trial p2pool/test/test_p2p_regtest.py
