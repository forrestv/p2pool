machine:
   python:
    version: 2.7.6
general:
  branches:
    only:
      - feature-bitcoin-regtest
dependencies:
  pre:
    - sudo apt-add-repository ppa:bitcoin/bitcoin -y
    - sudo apt-get autoremove -y && sudo apt-get update -q
    - sudo apt-get install --no-install-recommends --no-upgrade -qq screen bitcoind
  override:
    - pip install -r requirements.txt
test:
  pre:
    - mkdir /home/ubuntu/.bitcoin
    - cp test-data/bitcoin.conf /home/ubuntu/.bitcoin/.
    - chmod 600 /home/ubuntu/.bitcoin/bitcoin.conf
    - bitcoind --regtest --daemon
    - sleep 5
    - bitcoin-cli --regtest setgenerate true 50
    #run checks that bitcoind is running
    - bitcoin-cli --regtest getinfo
    - bitcoin-cli --regtest getblockhash 20
    - screen -L -dmS p2pool python run_p2pool.py --regtest --irc-announce
    - sleep 60
    - ls
  override:
    - trial p2pool/test/test_p2p_regtest.py
